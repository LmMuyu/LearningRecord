{"version":3,"sources":["webpack:///F:/LearningRecord/components/robby-image-upload/robby-image-upload.vue?76d7","webpack:///F:/LearningRecord/components/robby-image-upload/robby-image-upload.vue?dc75","webpack:///F:/LearningRecord/components/robby-image-upload/robby-image-upload.vue?2f43","webpack:///F:/LearningRecord/components/robby-image-upload/robby-image-upload.vue?f431","uni-app:///components/robby-image-upload/robby-image-upload.vue","webpack:///F:/LearningRecord/components/robby-image-upload/robby-image-upload.vue?866e"],"names":["renderjs","component","options","__file","components","render","_vm","this","_h","$createElement","l0","_self","_c","__map","imageListData","path","index","m0","isDragging","$orig","__get_orig","$mp","data","Object","assign","$root","recyclableRender","staticRenderFns","_withStripped","name","props","imageBasePos","x0","y0","w","h","showMoveImage","moveImagePath","moveLeft","moveTop","deltaLeft","deltaTop","dragIndex","targetImageIndex","imageList","isDestroyed","isshowUploadProgress","showUploadProgress","mounted","value","destroyed","computed","posMoveImageLeft","posMoveImageTop","isShowDel","enableDel","isShowAdd","enableAdd","limit","length","isDragable","enableDrag","methods","selectImage","uni","chooseImage","count","success","availableImageNumber","imagePathArr","showToast","title","icon","mask","duration","serverUrl","remoteIndexStart","promiseWorkList","keyname","fileKeyName","completeImages","push","Promise","all","then","result","$emit","currentImages","allImages","deleteImage","imageIndex","e","currentTarget","dataset","deletedImagePath","splice","serverUrlDeleteImage","request","url","method","imagePath","console","log","res","currentImage","previewImage","current","indicator","loop","urls","initImageBasePos","getSystemInfo","leftPadding","imageWidth","findOverlapImage","indx","start","currentImageOffsetTop","basePosY","target","offsetLeft","offsetTop","move","touch","clientX","clientY","stop"],"mappings":"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","file":"components/robby-image-upload/robby-image-upload.js","sourcesContent":["import { render, staticRenderFns, recyclableRender, components } from \"./robby-image-upload.vue?vue&type=template&id=f5aed778&\"\nvar renderjs\nimport script from \"./robby-image-upload.vue?vue&type=script&lang=js&\"\nexport * from \"./robby-image-upload.vue?vue&type=script&lang=js&\"\nimport style0 from \"./robby-image-upload.vue?vue&type=style&index=0&lang=css&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null,\n  false,\n  components,\n  renderjs\n)\n\ncomponent.options.__file = \"components/robby-image-upload/robby-image-upload.vue\"\nexport default component.exports","export * from \"-!../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/loaders/templateLoader.js??vue-loader-options!../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--16-0!../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/template.js!../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-uni-app-loader/page-meta.js!../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./robby-image-upload.vue?vue&type=template&id=f5aed778&\"","var components\nvar render = function() {\n  var _vm = this\n  var _h = _vm.$createElement\n  var _c = _vm._self._c || _h\n  var l0 = _vm.__map(_vm.imageListData, function(path, index) {\n    var m0 = _vm.isDragging(index)\n    return {\n      $orig: _vm.__get_orig(path),\n      m0: m0\n    }\n  })\n\n  _vm.$mp.data = Object.assign(\n    {},\n    {\n      $root: {\n        l0: l0\n      }\n    }\n  )\n}\nvar recyclableRender = false\nvar staticRenderFns = []\nrender._withStripped = true\n\nexport { render, staticRenderFns, recyclableRender, components }","import mod from \"-!../../../HBuilderX/plugins/uniapp-cli/node_modules/babel-loader/lib/index.js!../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--12-1!../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/script.js!../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./robby-image-upload.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../../HBuilderX/plugins/uniapp-cli/node_modules/babel-loader/lib/index.js!../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--12-1!../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/script.js!../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./robby-image-upload.vue?vue&type=script&lang=js&\"","<template>\n  <view class=\"imageUploadContainer\">\n    <view class=\"imageUploadList\">\n      <view\n        class=\"imageItem\"\n        v-bind:key=\"index\"\n        v-for=\"(path, index) in imageListData\"\n      >\n        <image\n          :src=\"path\"\n          :class=\"{ dragging: isDragging(index) }\"\n          draggable=\"true\"\n          @tap=\"previewImage\"\n          :data-index=\"index\"\n          @touchstart=\"start\"\n          @touchmove.stop.prevent=\"move\"\n          @touchend=\"stop\"\n        ></image>\n        <view\n          v-if=\"isShowDel\"\n          class=\"imageDel\"\n          @tap=\"deleteImage\"\n          :data-index=\"index\"\n          >x</view\n        >\n      </view>\n      <view v-if=\"isShowAdd\" class=\"imageUpload\" @tap=\"selectImage\">+</view>\n    </view>\n    <image\n      v-if=\"showMoveImage\"\n      class=\"moveImage\"\n      :style=\"{ left: posMoveImageLeft, top: posMoveImageTop }\"\n      :src=\"moveImagePath\"\n    ></image>\n  </view>\n</template>\n\n<script>\nexport default {\n  name: \"robby-image-upload\",\n  props: [\n    \"value\",\n    \"enableDel\",\n    \"enableAdd\",\n    \"enableDrag\",\n    \"serverUrl\",\n    \"formData\",\n    \"header\",\n    \"limit\",\n    \"fileKeyName\",\n    \"showUploadProgress\",\n    \"serverUrlDeleteImage\"\n  ],\n  data() {\n    return {\n      imageBasePos: {\n        x0: -1,\n        y0: -1,\n        w: -1,\n        h: -1\n      },\n      showMoveImage: false,\n      moveImagePath: \"\",\n      moveLeft: 0,\n      moveTop: 0,\n      deltaLeft: 0,\n      deltaTop: 0,\n      dragIndex: null,\n      targetImageIndex: null,\n      imageList: [],\n      isDestroyed: false,\n      isshowUploadProgress: this.showUploadProgress\n    };\n  },\n  mounted: function() {\n    this.imageList = this.value;\n\n    if (this.isshowUploadProgress === false) {\n      this.isshowUploadProgress = false;\n    } else {\n      this.isshowUploadProgress = true;\n    }\n  },\n  destroyed: function() {\n    this.isDestroyed = true;\n  },\n  computed: {\n    imageListData: function() {\n      if (this.value) {\n        return this.value;\n      }\n    },\n    posMoveImageLeft: function() {\n      return this.moveLeft + \"px\";\n    },\n    posMoveImageTop: function() {\n      return this.moveTop + \"px\";\n    },\n    isShowDel: function() {\n      if (this.enableDel === false) {\n        return false;\n      } else {\n        return true;\n      }\n    },\n    isShowAdd: function() {\n      if (this.enableAdd === false) {\n        return false;\n      }\n\n      if (this.limit && this.imageList.length >= this.limit) {\n        return false;\n      }\n\n      return true;\n    },\n    isDragable: function() {\n      if (this.enableDrag === false) {\n        return false;\n      } else {\n        return true;\n      }\n    }\n  },\n  methods: {\n    selectImage: function() {\n      var _self = this;\n      if (!_self.imageList) {\n        _self.imageList = [];\n      }\n\n      uni.chooseImage({\n        count: _self.limit ? _self.limit - _self.imageList.length : 999,\n        success: function(e) {\n          let imagePathArr = e.tempFilePaths;\n\n          //如果设置了limit限制，在web上count参数无效，这里做判断控制选择的数量是否合要求\n          //在非微信小程序里，虽然可以选多张，但选择的结果会被截掉\n          //在app里，会自动做选择数量的限制\n          if (_self.limit) {\n            var availableImageNumber = _self.limit - _self.imageList.length;\n            if (availableImageNumber < imagePathArr.length) {\n              uni.showToast({\n                title:\n                  \"图片总数限制为\" +\n                  _self.limit +\n                  \"张，当前还可以选\" +\n                  availableImageNumber +\n                  \"张\",\n                icon: \"none\",\n                mask: false,\n                duration: 2000\n              });\n              return;\n            }\n          }\n\n          //检查服务器地址是否设置，设置即表示图片要上传到服务器\n          if (_self.serverUrl) {\n            uni.showToast({\n              title: \"上传进度：0/\" + imagePathArr.length,\n              icon: \"none\",\n              mask: false\n            });\n\n            var remoteIndexStart = _self.imageList.length - imagePathArr.length;\n            var promiseWorkList = [];\n            var keyname = _self.fileKeyName\n              ? _self.fileKeyName\n              : \"upload-images\";\n            var completeImages = 0;\n\n            for (let i = 0; i < imagePathArr.length; i++) {\n              promiseWorkList.push(\n                new Promise((resolve, reject) => {\n                  let remoteUrlIndex = remoteIndexStart + i;\n                  uni.uploadFile({\n                    url: _self.serverUrl,\n                    fileType: \"image\",\n                    header: _self.header,\n                    formData: _self.formData,\n                    filePath: imagePathArr[i],\n                    name: keyname,\n                    success: function(res) {\n                      if (res.statusCode === 200) {\n                        if (_self.isDestroyed) {\n                          return;\n                        }\n\n                        completeImages++;\n\n                        if (_self.isshowUploadProgress) {\n                          uni.showToast({\n                            title:\n                              \"上传进度：\" +\n                              completeImages +\n                              \"/\" +\n                              imagePathArr.length,\n                            icon: \"none\",\n                            mask: false,\n                            duration: 500\n                          });\n                        }\n                        console.log(\"success to upload image: \" + res.data);\n                        resolve(res.data);\n                      } else {\n                        console.log(\"fail to upload image:\" + res.data);\n                        reject(\"fail to upload image:\" + remoteUrlIndex);\n                      }\n                    },\n                    fail: function(res) {\n                      console.log(\"fail to upload image:\" + res);\n                      reject(\"fail to upload image:\" + remoteUrlIndex);\n                    }\n                  });\n                })\n              );\n            }\n            Promise.all(promiseWorkList).then(result => {\n              if (_self.isDestroyed) {\n                return;\n              }\n\n              for (let i = 0; i < result.length; i++) {\n                _self.imageList.push(result[i]);\n              }\n\n              _self.$emit(\"add\", {\n                currentImages: imagePathArr,\n                allImages: _self.imageList\n              });\n              _self.$emit(\"input\", _self.imageList);\n            });\n          } else {\n            for (let i = 0; i < imagePathArr.length; i++) {\n              _self.imageList.push(imagePathArr[i]);\n            }\n\n            _self.$emit(\"add\", {\n              currentImages: imagePathArr,\n              allImages: _self.imageList\n            });\n            _self.$emit(\"input\", _self.imageList);\n          }\n        }\n      });\n    },\n    deleteImage: function(e) {\n      var imageIndex = e.currentTarget.dataset.index;\n      var deletedImagePath = this.imageList[imageIndex];\n      this.imageList.splice(imageIndex, 1);\n\n      //检查删除图片的服务器地址是否设置，如果设置则调用API，在服务器端删除该图片\n      if (this.serverUrlDeleteImage) {\n        uni.request({\n          url: this.serverUrlDeleteImage,\n          method: \"GET\",\n          data: {\n            imagePath: deletedImagePath\n          },\n          success: res => {\n            console.log(res.data);\n          }\n        });\n      }\n\n      this.$emit(\"delete\", {\n        currentImage: deletedImagePath,\n        allImages: this.imageList\n      });\n      this.$emit(\"input\", this.imageList);\n    },\n    previewImage: function(e) {\n      var imageIndex = e.currentTarget.dataset.index;\n      uni.previewImage({\n        current: this.imageList[imageIndex],\n        indicator: \"number\",\n        loop: \"true\",\n        urls: this.imageList\n      });\n    },\n    initImageBasePos: function() {\n      let paddingRate = 0.024;\n      var _self = this;\n      //计算图片基准位置\n      uni.getSystemInfo({\n        success: function(obj) {\n          let screenWidth = obj.screenWidth;\n          let leftPadding = Math.ceil(paddingRate * screenWidth);\n          let imageWidth = Math.ceil((screenWidth - 2 * leftPadding) / 4);\n\n          _self.imageBasePos.x0 = leftPadding;\n          _self.imageBasePos.w = imageWidth;\n          _self.imageBasePos.h = imageWidth;\n        }\n      });\n    },\n    findOverlapImage: function(posX, posY) {\n      let rows = Math.floor(\n        (posX - this.imageBasePos.x0) / this.imageBasePos.w\n      );\n      let cols = Math.floor(\n        (posY - this.imageBasePos.y0) / this.imageBasePos.h\n      );\n      let indx = cols * 4 + rows;\n      return indx;\n    },\n    isDragging: function(indx) {\n      return this.dragIndex === indx;\n    },\n    start: function(e) {\n      console.log(this.isDragable);\n      if (!this.isDragable) {\n        return;\n      }\n      this.dragIndex = e.currentTarget.dataset.index;\n      this.moveImagePath = this.imageList[this.dragIndex];\n      this.showMoveImage = true;\n\n      //计算纵向图片基准位置\n      if (this.imageBasePos.y0 === -1) {\n        this.initImageBasePos();\n\n        let basePosY = Math.floor(this.dragIndex / 4) * this.imageBasePos.h;\n        let currentImageOffsetTop = e.currentTarget.offsetTop;\n        this.imageBasePos.y0 = currentImageOffsetTop - basePosY;\n      }\n\n      //设置选中图片当前左上角的坐标\n      this.moveLeft = e.target.offsetLeft;\n      this.moveTop = e.target.offsetTop;\n    },\n    move: function(e) {\n      if (!this.isDragable) {\n        return;\n      }\n      const touch = e.touches[0];\n      this.targetImageIndex = this.findOverlapImage(\n        touch.clientX,\n        touch.clientY\n      );\n\n      //初始化deltaLeft/deltaTop\n      if (this.deltaLeft === 0) {\n        this.deltaLeft = touch.clientX - this.moveLeft;\n        this.deltaTop = touch.clientY - this.moveTop;\n      }\n\n      //设置移动图片位置\n      this.moveLeft = touch.clientX - this.deltaLeft;\n      this.moveTop = touch.clientY - this.deltaTop;\n    },\n    stop: function(e) {\n      if (!this.isDragable) {\n        return;\n      }\n      if (this.dragIndex !== null && this.targetImageIndex !== null) {\n        if (this.targetImageIndex < 0) {\n          this.targetImageIndex = 0;\n        }\n\n        if (this.targetImageIndex >= this.imageList.length) {\n          this.targetImageIndex = this.imageList.length - 1;\n        }\n        //交换图片\n        if (this.dragIndex !== this.targetImageIndex) {\n          this.imageList[this.dragIndex] = this.imageList[\n            this.targetImageIndex\n          ];\n          this.imageList[this.targetImageIndex] = this.moveImagePath;\n        }\n      }\n\n      this.dragIndex = null;\n      this.targetImageIndex = null;\n      this.deltaLeft = 0;\n      this.deltaTop = 0;\n      this.showMoveImage = false;\n\n      this.$emit(\"input\", this.imageList);\n    }\n  }\n};\n</script>\n\n<style>\n.imageUploadContainer {\n  padding: 10upx 5upx;\n  margin: 10upx 5upx;\n}\n\n.dragging {\n  transform: scale(1.2);\n}\n\n.imageUploadList {\n  display: flex;\n  flex-wrap: wrap;\n}\n\n.imageItem,\n.imageUpload {\n  width: 160upx;\n  height: 160upx;\n  margin: 10upx;\n}\n\n.imageDel {\n  position: relative;\n  left: 120upx;\n  bottom: 165upx;\n  background-color: rgba(0, 0, 0, 0.5);\n  width: 36upx;\n  text-align: center;\n  line-height: 35upx;\n  border-radius: 17upx;\n  color: white;\n  font-size: 30upx;\n  padding-bottom: 2upx;\n}\n\n.imageItem image,\n.moveImage {\n  width: 160upx;\n  height: 160upx;\n  border-radius: 8upx;\n}\n\n.imageUpload {\n  line-height: 130upx;\n  text-align: center;\n  font-size: 150upx;\n  color: #d9d9d9;\n  border: 1px solid #d9d9d9;\n  border-radius: 8upx;\n}\n\n.moveImage {\n  position: absolute;\n}\n</style>","import mod from \"-!../../../HBuilderX/plugins/uniapp-cli/node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../../HBuilderX/plugins/uniapp-cli/node_modules/css-loader/dist/cjs.js??ref--6-oneOf-1-1!../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/loaders/stylePostLoader.js!../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--6-oneOf-1-2!../../../HBuilderX/plugins/uniapp-cli/node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-3!../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./robby-image-upload.vue?vue&type=style&index=0&lang=css&\"; export default mod; export * from \"-!../../../HBuilderX/plugins/uniapp-cli/node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../../HBuilderX/plugins/uniapp-cli/node_modules/css-loader/dist/cjs.js??ref--6-oneOf-1-1!../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/loaders/stylePostLoader.js!../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--6-oneOf-1-2!../../../HBuilderX/plugins/uniapp-cli/node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-3!../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./robby-image-upload.vue?vue&type=style&index=0&lang=css&\""],"sourceRoot":""}